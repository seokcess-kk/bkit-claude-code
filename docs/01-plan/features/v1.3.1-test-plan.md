# v1.3.1 테스트 계획

> **목적**: Node.js hooks 전환 및 기존 bkit 기능 검증
>
> **테스트 환경**: `claude --plugin-dir .`
>
> **테스터**: Claude Code (bkit 플러그인 로드된 세션)
>
> **Date**: 2026-01-23

---

## 테스트 개요

### 테스트 범위

| 카테고리 | 항목 수 | 우선순위 |
|----------|:-------:|:--------:|
| **Node.js Hooks (v1.3.1 신규)** | 21 | P0 |
| **Task System 통합 (v1.3.1 신규)** | 12 | P0 |
| **Commands** | 20 | P1 |
| **Agents** | 11 | P1 |
| **Skills** | 18 | P2 |
| **PDCA 워크플로우** | 4 | P0 |

---

## Phase 1: Node.js Hooks 동작 테스트 (P0)

### 1.1 lib/common.js 함수 테스트

테스트 방법: 간단한 파일 Write/Edit 시도하여 hooks 동작 확인

```
테스트 명령:
"test.txt 파일에 'hello world' 작성해줘"

예상 결과:
- pre-write.js 실행됨 (PreToolUse hook)
- pdca-post-write.js 실행됨 (PostToolUse hook)
- 파일 정상 생성됨
```

**검증 항목:**
- [ ] `readStdinSync()` - JSON 입력 정상 파싱
- [ ] `parseHookInput()` - tool_name, file_path 추출
- [ ] `outputAllow()` - `{"decision":"allow"}` 출력
- [ ] `outputBlock()` - `{"decision":"block"}` 출력
- [ ] `isSourceFile()` - 소스 파일 판별
- [ ] `classifyTask()` - 작업 크기 분류

### 1.2 SessionStart Hook 테스트 (Iteration 2 추가)

| Script | Trigger | 테스트 방법 |
|--------|---------|------------|
| `hooks/session-start.js` | 세션 시작 | `claude --plugin-dir .` 실행 후 첫 메시지 |

**예상 결과:**
- AskUserQuestion 4가지 옵션 표시
- Project level 감지 동작
- PDCA phase 감지 동작

### 1.3 PreToolUse Hooks 테스트

| Script | Trigger | 테스트 방법 |
|--------|---------|------------|
| `pre-write.js` | Write/Edit | 아무 파일 생성/수정 |
| `pdca-pre-write.js` | Write (docs/) | docs/ 폴더에 파일 작성 |
| `design-validator-pre.js` | Write (design-validator agent) | design-validator 에이전트 실행 |
| `qa-pre-bash.js` | Bash (qa-monitor agent) | qa-monitor 에이전트에서 docker 명령 |
| `phase2-convention-pre.js` | Write (phase-2 skill) | phase-2-convention 스킬 사용 |
| `phase9-deploy-pre.js` | Write (phase-9 skill) | phase-9-deployment 스킬 사용 |

### 1.4 PostToolUse Hooks 테스트

| Script | Trigger | 테스트 방법 |
|--------|---------|------------|
| `pdca-post-write.js` | Write 완료 | 파일 작성 후 동작 확인 |
| `gap-detector-post.js` | gap-detector 완료 | gap-detector 에이전트 실행 |
| `qa-monitor-post.js` | qa-monitor 완료 | qa-monitor 에이전트 실행 |
| `phase5-design-post.js` | phase-5 Write 완료 | phase-5-design-system 스킬 사용 |
| `phase6-ui-post.js` | phase-6 Write 완료 | phase-6-ui-integration 스킬 사용 |

### 1.5 Stop Hooks 테스트

| Script | Trigger | 테스트 방법 |
|--------|---------|------------|
| `gap-detector-stop.js` | gap-detector 종료 | gap-detector 에이전트 완료 |
| `iterator-stop.js` | pdca-iterator 종료 | /pdca-iterate 실행 |
| `analysis-stop.js` | code-analyzer 종료 | code-analyzer 에이전트 실행 |
| `qa-stop.js` | qa-monitor 종료 | qa-monitor 완료 |
| `phase4-api-stop.js` | phase-4 종료 | phase-4-api 스킬 완료 |
| `phase8-review-stop.js` | phase-8 종료 | phase-8-review 스킬 완료 |

---

## Phase 2: 핵심 Commands 테스트 (P1)

### 2.1 PDCA Commands

| Command | 테스트 방법 | 예상 결과 |
|---------|------------|----------|
| `/pdca-status` | 명령 실행 | 현재 PDCA 상태 표시 |
| `/pdca-plan {feature}` | `/pdca-plan test-feature` | Plan 문서 생성 |
| `/pdca-design {feature}` | `/pdca-design test-feature` | Design 문서 생성 |
| `/pdca-analyze {feature}` | `/pdca-analyze claude-code-2.1.17-upgrade` | Gap 분석 실행 |
| `/pdca-iterate {feature}` | `/pdca-iterate test-feature` | 반복 개선 실행 |
| `/pdca-report {feature}` | `/pdca-report test-feature` | 완료 보고서 생성 |
| `/pdca-next` | 명령 실행 | 다음 PDCA 단계 안내 |

### 2.2 Pipeline Commands

| Command | 테스트 방법 | 예상 결과 |
|---------|------------|----------|
| `/pipeline-status` | 명령 실행 | 현재 Pipeline 단계 표시 |
| `/pipeline-start` | 명령 실행 | Pipeline 가이드 시작 |
| `/pipeline-next` | 명령 실행 | 다음 Pipeline 단계 안내 |

### 2.3 Init Commands

| Command | 테스트 방법 | 예상 결과 |
|---------|------------|----------|
| `/init-starter` | 명령 실행 | Starter 프로젝트 초기화 |
| `/init-dynamic` | 명령 실행 | Dynamic 프로젝트 초기화 |
| `/init-enterprise` | 명령 실행 | Enterprise 프로젝트 초기화 |

### 2.4 Utility Commands

| Command | 테스트 방법 | 예상 결과 |
|---------|------------|----------|
| `/archive {feature}` | `/archive test-feature` | 완료된 PDCA 문서 아카이브 |
| `/upgrade-level` | 명령 실행 | 레벨 업그레이드 가이드 |
| `/learn-claude-code` | 명령 실행 | Claude Code 학습 가이드 |
| `/setup-claude-code` | 명령 실행 | 프로젝트 설정 생성 |
| `/upgrade-claude-code` | 명령 실행 | Claude Code 설정 업그레이드 |
| `/zero-script-qa` | 명령 실행 | Zero Script QA 실행 |
| `/github-stats` | 명령 실행 | GitHub 통계 수집 |

---

## Phase 3: Agents 테스트 (P1)

### 3.1 PDCA Agents

| Agent | 테스트 방법 | 예상 결과 |
|-------|------------|----------|
| `gap-detector` | "설계와 구현 비교해줘" | Gap 분석 리포트 생성 |
| `pdca-iterator` | "자동으로 수정해줘" | 반복 개선 사이클 실행 |
| `design-validator` | "설계 문서 검증해줘" | 설계 완전성 검사 |
| `report-generator` | "완료 보고서 생성해줘" | PDCA 보고서 생성 |
| `code-analyzer` | "코드 품질 분석해줘" | 품질 분석 리포트 |

### 3.2 Level Agents

| Agent | 테스트 방법 | 예상 결과 |
|-------|------------|----------|
| `starter-guide` | Starter 프로젝트에서 도움 요청 | 친절한 가이드 |
| `bkend-expert` | "로그인 기능 추가해줘" | bkend.ai 연동 가이드 |
| `enterprise-expert` | "마이크로서비스 설계" | Enterprise 아키텍처 가이드 |
| `infra-architect` | "AWS 인프라 설계" | 인프라 아키텍처 가이드 |

### 3.3 Utility Agents

| Agent | 테스트 방법 | 예상 결과 |
|-------|------------|----------|
| `pipeline-guide` | "어디서부터 시작해야 해?" | 9단계 파이프라인 가이드 |
| `qa-monitor` | "Docker 로그 분석해줘" | 로그 기반 QA 실행 |

---

## Phase 4: Skills 테스트 (P2)

### 4.1 Core Skills (Hooks 연동)

| Skill | 테스트 방법 | Hook 검증 |
|-------|------------|----------|
| `bkit-rules` | 파일 Write/Edit | pre-write.js, pdca-post-write.js |
| `zero-script-qa` | QA 실행 | qa-pre-bash.js, qa-stop.js |
| `phase-4-api` | API 설계 | phase4-api-stop.js |
| `phase-5-design-system` | 디자인 시스템 | phase5-design-post.js |
| `phase-6-ui-integration` | UI 통합 | phase6-ui-post.js |
| `phase-8-review` | 코드 리뷰 | phase8-review-stop.js |
| `phase-9-deployment` | 배포 준비 | phase9-deploy-pre.js |

### 4.2 Level Skills

| Skill | 테스트 방법 |
|-------|------------|
| `starter` | Starter 프로젝트 가이드 요청 |
| `dynamic` | 풀스택 개발 가이드 요청 |
| `enterprise` | 엔터프라이즈 가이드 요청 |

### 4.3 Platform Skills

| Skill | 테스트 방법 |
|-------|------------|
| `mobile-app` | 모바일 앱 개발 가이드 요청 |
| `desktop-app` | 데스크톱 앱 개발 가이드 요청 |

### 4.4 Phase Skills

| Skill | 테스트 방법 |
|-------|------------|
| `phase-1-schema` | 용어 정의 가이드 요청 |
| `phase-2-convention` | 코딩 컨벤션 가이드 요청 |
| `phase-3-mockup` | 목업 생성 가이드 요청 |
| `phase-7-seo-security` | SEO/보안 가이드 요청 |

### 4.5 Utility Skills

| Skill | 테스트 방법 |
|-------|------------|
| `bkit-templates` | 템플릿 사용 가이드 요청 |
| `development-pipeline` | 파이프라인 설명 요청 |

---

## Phase 5: Task System 통합 테스트 (P0) - v1.3.1 신규

### 5.1 lib/common.js Task 헬퍼 함수

| 함수 | 테스트 방법 | 예상 결과 |
|------|------------|----------|
| `PDCA_PHASES` | 상수 참조 | 5개 phase 정보 |
| `getPdcaTaskMetadata()` | 함수 호출 | phase, feature, matchRate 등 메타데이터 |
| `generatePdcaTaskSubject()` | 함수 호출 | `[Phase] feature` 형식 |
| `generatePdcaTaskDescription()` | 함수 호출 | PDCA 문서 경로 포함 설명 |
| `generateTaskGuidance()` | 함수 호출 | Task 생성 안내 문자열 |
| `getPreviousPdcaPhase()` | 함수 호출 | 이전 phase 반환 |
| `findPdcaStatus()` | 함수 호출 | .pdca-status.json 또는 docs/ 스캔 |
| `getCurrentPdcaPhase()` | 함수 호출 | 현재 feature의 PDCA phase |

### 5.2 Hook Scripts Task Guidance 출력

| Script | 테스트 방법 | 예상 결과 |
|--------|------------|----------|
| `pre-write.js` | Feature-level Write | Task guidance 메시지 포함 |
| `pdca-post-write.js` | 소스 파일 Write 완료 | Task guidance for Do phase |
| `gap-detector-stop.js` | gap-detector 완료 | Task guidance for Check/Act phase |
| `iterator-stop.js` | pdca-iterator 완료 | Task guidance for Act phase |

**검증 방법:**
```bash
# Hook 출력에 Task 관련 안내 포함 확인
echo '{"tool_name":"Write","file_path":"src/test.ts"}' | node scripts/pre-write.js
# 출력에 "Task:" 또는 "TaskCreate" 관련 안내 포함되어야 함
```

### 5.3 PDCA Commands Task 연동

| Command | Task 동작 | 예상 결과 |
|---------|----------|----------|
| `/pdca-plan {feature}` | TaskCreate | `[Plan] feature` Task 생성 |
| `/pdca-design {feature}` | TaskCreate + blockedBy | `[Design] feature` Task, Plan 의존성 |
| `/pdca-analyze {feature}` | TaskCreate + metadata | `[Check] feature` Task, matchRate 포함 |
| `/pdca-iterate {feature}` | TaskUpdate | `[Act-N] feature` Task, 반복 추적 |

### 5.4 Agents Task 연동

| Agent | Task 동작 | 예상 결과 |
|-------|----------|----------|
| `gap-detector` | TaskCreate (Check phase) | Check Task + matchRate 메타데이터 |
| `pdca-iterator` | TaskCreate/Update (Act phase) | Act-N Task 체인, iteration 추적 |

### 5.5 Task Dependency Chain 테스트

```
시나리오: 전체 PDCA Task 체인 생성

1. /pdca-plan login
   → [Plan] login (Task #1) 생성

2. /pdca-design login
   → [Design] login (Task #2) 생성
   → blockedBy: [Task #1]

3. ... 구현 ...
   → [Do] login Task (선택적)

4. /pdca-analyze login
   → [Check] login (Task #3) 생성
   → metadata: { matchRate: XX }
   → matchRate < 90%: [Act] login Task 자동 생성

5. /pdca-iterate login (if needed)
   → [Act-1] login (Task #4) 생성
   → blockedBy: [Task #3]
   → 반복 시 [Act-2], [Act-3] ... 추가
```

---

## Phase 6: 통합 시나리오 테스트 (P0)

### 6.1 전체 PDCA 사이클 (Task 통합 포함)

```
시나리오: 간단한 기능 추가 후 PDCA 완료 + Task 체인 검증

1. Plan: "/pdca-plan simple-button"
   → docs/01-plan/features/simple-button.plan.md 생성
   → Task: [Plan] simple-button 생성 확인

2. Design: "/pdca-design simple-button"
   → docs/02-design/features/simple-button.design.md 생성
   → Task: [Design] simple-button 생성, blockedBy: [Plan] 확인

3. Do: "버튼 구현해줘"
   → src/components/SimpleButton.tsx 생성
   → pre-write.js, pdca-post-write.js hooks 동작
   → Task guidance 출력 확인

4. Check: "/pdca-analyze simple-button"
   → gap-detector 실행
   → docs/03-analysis/simple-button.analysis.md 생성
   → Task: [Check] simple-button 생성, matchRate 메타데이터 확인
   → matchRate < 90%: [Act] Task 자동 생성 확인

5. Iterate (if needed): "/pdca-iterate simple-button"
   → pdca-iterator 실행
   → Task: [Act-N] simple-button 반복 추적 확인

6. Report: "/pdca-report simple-button"
   → report-generator 실행
   → docs/04-report/simple-button.report.md 생성
   → 모든 PDCA Task completed 상태 확인
```

### 6.2 SessionStart Hook

```
시나리오: 새 세션 시작

1. claude --plugin-dir . 실행
2. 첫 메시지 입력
3. AskUserQuestion 표시 확인:
   - Learn bkit
   - Learn Claude Code
   - Continue Previous Work
   - Start New Project
```

### 6.3 Level 자동 감지

```
시나리오: 프로젝트 레벨 감지

1. Starter: 기본 Next.js 프로젝트
2. Dynamic: bkend/.mcp.json 존재
3. Enterprise: turbo.json + services/ 존재
```

---

## 테스트 실행 순서

### Quick Test (10분)

필수 동작 확인:

1. [ ] 파일 Write 테스트 → hooks 동작 확인
2. [ ] `/pdca-status` 실행
3. [ ] gap-detector 에이전트 실행

### Standard Test (30분)

주요 기능 확인:

1. [ ] Phase 1: Node.js Hooks (1.1 ~ 1.4)
2. [ ] Phase 2: PDCA Commands
3. [ ] Phase 3: PDCA Agents

### Full Test (1시간)

전체 기능 확인:

1. [ ] Phase 1 ~ 5 모든 항목
2. [ ] 통합 시나리오 테스트

---

## 테스트 결과 기록

### 테스트 로그 위치

```
docs/03-analysis/v1.3.1-test-results.md
```

### 결과 기록 형식

```markdown
## 테스트 결과

| 항목 | 결과 | 비고 |
|------|:----:|------|
| pre-write.js | ✅/❌ | (이슈 설명) |
| /pdca-status | ✅/❌ | (이슈 설명) |
| ... | ... | ... |

## 발견된 이슈

### Issue #1: (제목)
- **증상**:
- **원인**:
- **해결**:
```

---

## 롤백 계획

문제 발생 시:

```bash
# v1.3.0으로 롤백
git checkout v1.3.0 -- scripts/ lib/

# 또는 전체 롤백
git reset --hard HEAD~1
```

---

## 완료 기준

- [ ] Phase 1 모든 hooks 정상 동작
- [ ] Phase 2 모든 commands 정상 동작
- [ ] Phase 3 주요 agents 정상 동작
- [ ] Phase 5 통합 시나리오 통과
- [ ] 발견된 Critical 이슈 0건

